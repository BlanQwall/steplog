name: Deploy CN site to COS

on:
  push:
    branches: [ "main" ]

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      # 如果你有 build-cn.sh，就用它先生成干净的部署目录
      - name: Build deploy-cn folder
        run: |
          chmod +x build-cn.sh
          ./build-cn.sh

      - name: Install COSCLI
        run: |
          curl -fsSL https://coscli.cloud.tencent.com/install.sh | sh
          echo "$HOME/coscli" >> $GITHUB_PATH

      - name: Sync deploy-cn to COS
        env:
          TENCENT_SECRET_ID: ${{ secrets.TENCENT_SECRET_ID }}
          TENCENT_SECRET_KEY: ${{ secrets.TENCENT_SECRET_KEY }}
        run: |
          coscli sync ./deploy-cn cos://steplog-cn-1390433657/ \
            --region ap-hongkong \
            --secret-id "$TENCENT_SECRET_ID" \
            --secret-key "$TENCENT_SECRET_KEY" \
            --delete --force
